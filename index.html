<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TTP Template Processor</title>
    <!-- CodeMirror 6 CSS is included in the modules -->
    <link rel="stylesheet" href="css/main.css">
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="header-left">
                <h1>TTP Template Processor</h1>
            </div>
            <div class="header-controls">
                <button id="processBtn" class="btn btn-primary">Process Template</button>
                <button id="clearBtn" class="btn btn-secondary">Clear All</button>
                <button id="exampleBtn" class="btn btn-secondary">Load Example</button>
                <button id="downloadBtn" class="btn btn-secondary">Download Result</button>
                <select id="outputFormat" class="format-select">
                    <option value="json">JSON</option>
                    <option value="yaml">YAML</option>
                    <option value="table">Table</option>
                </select>
                <button id="globalVarsBtn" class="btn btn-secondary">Vars</button>
                <button id="functionsBtn" class="btn btn-secondary">Functions</button>
                <button id="lookupsBtn" class="btn btn-secondary">Lookups</button>
                <label class="auto-process-toggle">
                    <input type="checkbox" id="autoProcess" checked>
                    Auto Process
                </label>
            </div>
        </header>

        <main class="main-content">
            <div class="pane-container">
                <!-- Data Input Pane -->
                <div class="pane data-pane">
                    <div class="panel-header">
                        <span class="panel-title">Input Data</span>
                    </div>
                    <div class="editor-wrapper">
                        <textarea id="dataInput" placeholder="Paste your raw text data here..."></textarea>
                    </div>
                </div>

                <!-- Resize Handle 1 -->
                <div class="resize-handle" data-direction="horizontal"></div>

                <!-- Template Input Pane -->
                <div class="pane template-pane">
                    <div class="panel-header">
                        <span class="panel-title">TTP Template</span>
                    </div>
                    <div class="editor-wrapper">
                        <textarea id="templateInput" placeholder="Enter your TTP template here..."></textarea>
                    </div>
                </div>

                <!-- Resize Handle 2 -->
                <div class="resize-handle" data-direction="horizontal"></div>

                <!-- Results Pane -->
                <div class="pane result-pane">
                    <div class="panel-header">
                        <span class="panel-title">Parsed Results</span>
                    </div>
                    <div class="result-wrapper">
                        <div id="resultOutput">Results will appear here after processing...</div>
                    </div>
                </div>
            </div>
        </main>

        <div class="status-bar">
            <div class="status-item">
                <span id="pyodideStatus">Loading Python runtime...</span>
            </div>
            <div class="status-item">
                <span id="processingTime"></span>
            </div>
        </div>
    </div>

    <!-- Global Variables Modal -->
    <div id="globalVarsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Variables</h2>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <div class="vars-format-selector">
                    <label for="varsFormat">Format:</label>
                    <select id="varsFormat" class="format-select">
                        <option value="json">JSON</option>
                        <option value="yaml">YAML</option>
                        <option value="python">Python Dict</option>
                    </select>
                </div>
                <div class="vars-editor-container">
                    <div id="varsEditor" class="vars-editor"></div>
                </div>
                <div class="modal-footer">
                    <button id="saveVarsBtn" class="btn btn-primary">Save Variables</button>
                    <button id="clearVarsBtn" class="btn btn-secondary">Clear</button>
                    <button id="cancelVarsBtn" class="btn btn-secondary">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Functions Modal -->
    <div id="functionsModal" class="modal">
        <div class="modal-content functions-modal-content">
            <div class="modal-header">
                <h2>Custom Functions</h2>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <div class="functions-container" id="functionsContainer">
                    <!-- Function entries will be added here dynamically -->
                </div>
                <button id="addFunctionBtn" class="btn btn-secondary add-function-btn">+ Add Function</button>
                <div class="modal-footer">
                    <button id="saveFunctionsBtn" class="btn btn-primary">Save Functions</button>
                    <button id="clearFunctionsBtn" class="btn btn-secondary">Clear All</button>
                    <button id="cancelFunctionsBtn" class="btn btn-secondary">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Lookups Modal -->
    <div id="lookupsModal" class="modal">
        <div class="modal-content lookups-modal-content">
            <div class="modal-header">
                <h2>Lookup Tables</h2>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <div class="lookups-container" id="lookupsContainer">
                    <!-- Lookup entries will be added here dynamically -->
                </div>
                <button id="addLookupBtn" class="btn btn-secondary add-lookup-btn">+ Add Lookup</button>
                <div class="modal-footer">
                    <button id="saveLookupsBtn" class="btn btn-primary">Save Lookups</button>
                    <button id="clearLookupsBtn" class="btn btn-secondary">Clear All</button>
                    <button id="cancelLookupsBtn" class="btn btn-secondary">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <p>Initializing Python runtime...</p>
            <p class="loading-detail">This may take a moment on first load</p>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/pyodide/v0.28.2/full/pyodide.js"></script>
    <!-- Monaco Editor -->
    <script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.44.0/min/vs/loader.js"></script>
    <script>
        // Configure Monaco Editor
        require.config({ paths: { 'vs': 'https://cdn.jsdelivr.net/npm/monaco-editor@0.44.0/min/vs' }});
        
        require(['vs/editor/editor.main'], function () {
            // Set up Monaco Editor theme
            monaco.editor.setTheme('vs-dark');
            
            // Make Monaco available globally
            window.MonacoEditor = monaco.editor;
            window.MonacoLanguages = monaco.languages;
            
            console.log('Monaco Editor loaded successfully');
            
            // Trigger editor initialization when Monaco is ready
            if (window.initializeEditors) {
                window.initializeEditors();
            }
        });
    </script>
    <script src="js/examples.js"></script>
    <script src="js/ttp-processor.js"></script>
    <script>
        // Debug: Check if examples loaded
        console.log('After examples.js load, window.TTP_EXAMPLES:', window.TTP_EXAMPLES);
    </script>
    <script src="js/app-monaco.js"></script>
</body>
</html>
